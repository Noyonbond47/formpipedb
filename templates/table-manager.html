<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Manager - FormPipeDB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style> 
        body { font-family: 'Inter', sans-serif; }
        .modal { transition: opacity 0.25s ease; }
    </style>
</head>
<body class="bg-gray-50">

<div class="flex h-screen">
    <!-- Left Sidebar -->
    <aside class="w-72 bg-white border-r flex flex-col">
        <div class="p-4 border-b">
            <a href="/app" class="text-sm text-blue-600 hover:underline">&larr; Back to Dashboard</a>
            <h1 class="text-2xl font-bold text-gray-800 mt-2">{{ db_name }}</h1>
        </div>
        <div class="p-4 border-b">
            <h2 class="text-lg font-semibold text-gray-700">Tables</h2>
        </div>
        <nav id="table-list" class="flex-1 p-4 space-y-1 overflow-y-auto">
            <!-- Table links will be injected here -->
        </nav>
        <div class="p-4 border-t space-y-2">
            <button id="create-table-btn" class="w-full text-center p-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 font-semibold">Create Table</button>
            <button id="delete-table-btn" class="w-full text-center p-2 rounded-md bg-red-100 text-red-700 hover:bg-red-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>Delete Table</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main id="main-content" class="flex-1 p-8 overflow-auto hidden">
        <div class="border-b mb-6">
            <nav class="flex space-x-6">
                <button data-tab="structure" class="tab-btn py-2 px-1 font-medium border-b-2 border-blue-500 text-blue-600">Structure</button>
                <button data-tab="data" class="tab-btn py-2 px-1 font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700">Data</button>
            </nav>
        </div>

        <!-- Structure Tab Content -->
        <div id="structure-tab-content" class="tab-content">
            <div class="bg-white rounded-lg shadow-sm border overflow-hidden">
                <table class="min-w-full text-sm">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="p-3 text-left font-semibold">Column Name</th>
                            <th class="p-3 text-left font-semibold">Data Type</th>
                            <th class="p-3 text-center font-semibold">Not Null</th>
                            <th class="p-3 text-center font-semibold">Primary Key</th>
                            <th class="p-3 text-center font-semibold">Unique</th>
                            <th class="p-3 text-left font-semibold">Foreign Key</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y">
                        <tr>
                            <td class="p-3 font-mono">id</td>
                            <td class="p-3 font-mono text-purple-600">INTEGER</td>
                            <td class="p-3 text-center text-green-600">&#10003;</td>
                            <td class="p-3 text-center text-green-600">&#10003;</td>
                            <td class="p-3 text-center text-green-600">&#10003;</td>
                            <td class="p-3 font-mono"></td>
                        </tr>
                        <tr>
                            <td class="p-3 font-mono">email</td>
                            <td class="p-3 font-mono text-purple-600">TEXT</td>
                            <td class="p-3 text-center text-green-600">&#10003;</td>
                            <td class="p-3 text-center"></td>
                            <td class="p-3 text-center text-green-600">&#10003;</td>
                            <td class="p-3 font-mono"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="mt-6 flex gap-4">
                <button id="add-column-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Add Column</button>
                <button class="bg-gray-200 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-300">Remove Selected Column(s)</button>
            </div>
        </div>

        <!-- Data Tab Content -->
        <div id="data-tab-content" class="tab-content hidden">
            <div class="flex justify-end mb-4">
                <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Add Row</button>
                <button class="bg-gray-200 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-300 ml-2">Delete Selected Row(s)</button>
                <button class="bg-gray-200 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-300 ml-2">Export to CSV</button>
            </div>
            <div class="bg-white rounded-lg shadow-sm border overflow-auto max-h-[70vh]">
                <table class="min-w-full text-sm">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="p-3 text-left font-semibold">id</th>
                            <th class="p-3 text-left font-semibold">email</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y">
                        <tr>
                            <td class="p-3 font-mono">1</td>
                            <td class="p-3 font-mono">test@example.com</td>
                        </tr>
                        <tr>
                            <td class="p-3 font-mono">2</td>
                            <td class="p-3 font-mono">user@example.com</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Placeholder for initial view -->
    <div id="placeholder-content" class="flex-1 flex items-center justify-center text-gray-500">
        Select a table to view its structure and data.
    </div>
</div>

<!-- Add Column Modal -->
<div id="add-column-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6">
        <h3 class="text-lg font-semibold mb-6">Add New Column</h3>
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Column Name</label>
                <input type="text" class="mt-1 block w-full p-2 border rounded-md shadow-sm">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Data Type</label>
                <select class="mt-1 block w-full p-2 border rounded-md shadow-sm bg-white">
                    <option>TEXT</option>
                    <option>INTEGER</option>
                    <option>REAL</option>
                    <option>BLOB</option>
                    <option>NUMERIC</option>
                </select>
            </div>
            <fieldset class="space-y-2">
                <legend class="text-sm font-medium text-gray-700">Constraints</legend>
                <div class="grid grid-cols-2 gap-4">
                    <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2"> Primary Key</label>
                    <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2"> Autoincrement</label>
                    <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2"> Not Null</label>
                    <label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2"> Unique</label>
                </div>
            </fieldset>
            <div>
                <label class="flex items-center">
                    <input id="is-fk-checkbox" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2"> Is a Foreign Key
                </label>
            </div>
            <div id="fk-options" class="hidden space-y-4 border-t pt-4 mt-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">References Table</label>
                    <select class="mt-1 block w-full p-2 border rounded-md shadow-sm bg-white">
                        <option>users</option>
                        <option>products</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">References Column</label>
                    <select class="mt-1 block w-full p-2 border rounded-md shadow-sm bg-white">
                        <option>id</option>
                        <option>uuid</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="mt-8 flex justify-end gap-4">
            <button id="cancel-add-column-btn" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-300">Cancel</button>
            <button class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Add Column</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const tableList = document.getElementById('table-list');
    const mainContent = document.getElementById('main-content');
    const placeholderContent = document.getElementById('placeholder-content');
    const deleteTableBtn = document.getElementById('delete-table-btn');
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');

    // Mock data
    const mockTables = [
        { id: 1, name: 'users' },
        { id: 2, name: 'products' },
        { id: 3, name: 'orders' }
    ];

    function renderTables() {
        tableList.innerHTML = '';
        mockTables.forEach(table => {
            const tableLink = document.createElement('a');
            tableLink.href = '#';
            tableLink.className = 'block p-2 rounded-md hover:bg-gray-100';
            tableLink.textContent = table.name;
            tableLink.setAttribute('data-table-name', table.name);
            tableList.appendChild(tableLink);
        });
    }

    tableList.addEventListener('click', (e) => {
        if (e.target.tagName === 'A') {
            e.preventDefault();
            // Remove active class from all
            tableList.querySelectorAll('a').forEach(a => a.classList.remove('bg-blue-100', 'text-blue-700', 'font-semibold'));
            // Add active class to clicked
            e.target.classList.add('bg-blue-100', 'text-blue-700', 'font-semibold');
            
            mainContent.classList.remove('hidden');
            placeholderContent.classList.add('hidden');
            deleteTableBtn.disabled = false;
        }
    });

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const tab = button.dataset.tab;

            tabButtons.forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            button.classList.add('border-blue-500', 'text-blue-600');
            button.classList.remove('border-transparent', 'text-gray-500');

            tabContents.forEach(content => {
                if (content.id === `${tab}-tab-content`) {
                    content.classList.remove('hidden');
                } else {
                    content.classList.add('hidden');
                }
            });
        });
    });

    // Modal Logic
    const addColumnModal = document.getElementById('add-column-modal');
    const addColumnBtn = document.getElementById('add-column-btn');
    const cancelAddColumnBtn = document.getElementById('cancel-add-column-btn');
    const isFkCheckbox = document.getElementById('is-fk-checkbox');
    const fkOptions = document.getElementById('fk-options');

    function openModal(modal) {
        modal.classList.remove('hidden');
        setTimeout(() => modal.classList.remove('opacity-0'), 10);
    }

    function closeModal(modal) {
        modal.classList.add('opacity-0');
        setTimeout(() => modal.classList.add('hidden'), 250);
    }

    addColumnBtn.addEventListener('click', () => openModal(addColumnModal));
    cancelAddColumnBtn.addEventListener('click', () => closeModal(addColumnModal));

    isFkCheckbox.addEventListener('change', (e) => {
        if (e.target.checked) {
            fkOptions.classList.remove('hidden');
        } else {
            fkOptions.classList.add('hidden');
        }
    });

    // Initial render
    renderTables();
});
</script>

</body>
</html>